<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
</head>
<body>

<style type="text/css">
.left-col{
  float: left;
  width: 30%;
  max-width: 430px;
}

.right-col{
  float: left;
  width: 70%;
  height: 400px;
}

</style>

<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

<h1>Welcome to JP Morgan Trader's Dashboard</h1>

<div class="container">
  <div class='left-col'>
    <h2 class="form-signin-heading">Make order here</h2>
    <div>
      <div><input type="text" class="input-block-level" placeholder="Instrument ID" name="Instrument_id" id="instrument_id"></div>
      <div><input type="text" class="input-block-level" placeholder="Quantity" name="Quantity" id="quantity"></div>
      <div><input type="text" class="input-block-level" placeholder="Order size" id="order_size"></div>
      <div><input type="text" class="input-block-level" placeholder="Discount" name="Discount" id="discount"></div>
    </div>

    <!-- <button class="btn btn-large btn-primary" type="submit" onclick="WebSocketTest()">Make order</button> -->
    <button class="btn btn-large btn-primary" type="submit" id="make-order-btn">Make order</button>
  </div>

</div>
<div class="right-col">

  <!-- visualization should be implemented here -->

</div>


<script type="text/javascript">
	
// d3.json()

{% autoescape off %}
// var data = {{apple}}
{% endautoescape %}

// add index for each element
// for(var i = 0; i < data.length; i++){
// 	data[i]['index'] = i;	
// }


function WebSocketTest()
{
  if ("WebSocket" in window)
  {
     // open a websocket
     var ws = new WebSocket("ws://" + window.location.host + "/chat/");
     ws.onopen = function()
     {
        // Web Socket is connected, send data using send()
        ws.send(JSON.stringify({"instrument_id": document.getElementById("Instrument_id").value, 
                                "quantity": document.getElementById("Quantity").value, 
                                "order_discount": document.getElementById("Discount").value,
                                "order_size": document.getElementById("order_size").value
                                }));

        alert("Message is sent...");
     };
     ws.onmessage = function (evt) 
     { 
        var received_msg = evt.data;
        // alert("Message is received...");
        console.log(received_msg);
        console.log("message received!");
     };
     ws.onclose = function()
     { 
        // websocket is closed.
        // alert("Connection is closed..."); 
        console.log("connection closed");
     };
  }
  else
  {
     // The browser doesn't support WebSocket
     alert("WebSocket NOT supported by your Browser!");
  }
}



/************** NOT DONE YET **********************/
/************** CHI-AN WORKING ********************/

function collectOrderData(){
  // a function that returns a json object of 
  // form data. Check for missing values.

  var result = {};
  var data_fields = ["instrument_id", "quantity", "discount", "order_size"];
  var error_message = []

  for (var i = 0; i < data_fields.length; i++) {
    var value = document.getElementById(data_fields[i]);
    if (value === "") error_message.push(data_fields[i]);
    result[data_fields[i]] = value;
  };


  if (error_message.length > 0) {
    alert(error_message.join(", ") + " are not given in your order!");
    return null;
  }
  else{
    return result;
  }

}




document.getElementById("make-order-btn").addEventListener("click", WebSocketTest);




</script>


</body>

</html>